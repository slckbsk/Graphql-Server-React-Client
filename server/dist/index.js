"use strict";var _http=require("http");var _apolloServerExpress=require("apollo-server-express");var _apolloServerCore=require("apollo-server-core");var _schema=require("@graphql-tools/schema");var _ws=require("ws");var _subscriptionsTransportWs=require("subscriptions-transport-ws");var _graphql=require("graphql");var _typeDefs=_interopRequireDefault(require("./graphql/type-defs"));var _index=_interopRequireDefault(require("./graphql/resolvers/index"));var _express=_interopRequireDefault(require("express"));var _pubsub=_interopRequireDefault(require("./pubsub"));var _data=_interopRequireDefault(require("./data"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}var PORT=4000;var schema=(0,_schema.makeExecutableSchema)({typeDefs:_typeDefs["default"],resolvers:_index["default"]});var app=(0,_express["default"])();var httpServer=(0,_http.createServer)(app);var wsServer=new _ws.WebSocketServer({server:httpServer,path:"/graphql"});var serverCleanup=_subscriptionsTransportWs.SubscriptionServer.create({schema:schema,execute:_graphql.execute,subscribe:_graphql.subscribe,onConnect:function onConnect(){return{pubSub:_pubsub["default"],db:_data["default"]}}},wsServer);var server=new _apolloServerExpress.ApolloServer({schema:schema,context:function(){var _context=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",{pubSub:_pubsub["default"],db:_data["default"]});case 1:case"end":return _context2.stop();}}},_callee)}));function context(){return _context.apply(this,arguments)}return context}(),plugins:[{serverWillStart:function serverWillStart(){return _asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function _callee3$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",{drainServer:function drainServer(){return _asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return serverCleanup.dispose();case 2:case"end":return _context3.stop();}}},_callee2)}))()}});case 1:case"end":return _context4.stop();}}},_callee3)}))()}},(0,_apolloServerCore.ApolloServerPluginLandingPageGraphQLPlayground)()]});_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return server.start();case 2:server.applyMiddleware({app:app});case 3:case"end":return _context5.stop();}}},_callee4)}))();try{httpServer.listen(PORT,function(){console.log("\uD83D\uDE80 Query endpoint ready at http://localhost:".concat(PORT).concat(server.graphqlPath));console.log("\uD83D\uDE80 Subscription endpoint ready at ws://localhost:".concat(PORT).concat(server.graphqlPath))});console.log("server ==> HER\u015EEY YOLUNDA")}catch(error){console.log("Apollo server error !!!!!! ");throw new Error(error)}